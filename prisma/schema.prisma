// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client"
  output          = "../src/generated/prisma"
  previewFeatures = ["typedSql"]
}

datasource db {
  provider = "postgresql"
}

model RegisterCharacter {
  id                    String @id @default(uuid())
  characterName         String
  registerDiscordUserId String

  registerDate   DateTime  @default(now()) @db.Date
  unregisterDate DateTime? @default("2099-12-31T23:59:59.999Z") @db.Date

  raidCompletions       RaidCompletion[]
  raidEventParticipants RaidEventParticipant[]
  characterSettings     CharacterSetting?

  @@index([registerDiscordUserId, registerDate, unregisterDate])
}

enum RaidType {
  // A6
  Zenas
  Erenia

  // A7
  Kirollas
  Carno
  Bellia
  Paimon
  RevenantPaimon

  // A8
  Alzanor
  Valehir
  Asgobas
}

model RaidCompletion {
  id          String            @id @default(uuid())
  raidType    RaidType
  characterId String
  character   RegisterCharacter @relation(fields: [characterId], references: [id])
  raidDate    DateTime          @db.Date

  @@index([characterId, raidDate])
}

model RaidCompletionEvidence {
  id            String   @id @default(uuid())
  discordUserId String
  raidDate      DateTime @db.Date
  messageUrl    String

  @@index([discordUserId, raidDate])
}

enum ChannelType {
  // HC Tracker
  TodaySubmission
  OtherDateSubmission
  DailyNotification
  BotCommand

  // Raid Helper
  RaidEvent
}

enum Language {
  Chinese
  English
}

model ChannelSetting {
  id              String      @id @default(uuid())
  channelId       String
  channelType     ChannelType
  channelLanguage Language    @default(English)

  @@unique([channelId, channelType])
}

model CompletedProgress {
  id             String   @id @default(uuid())
  raidName       String   @unique
  completedCount Int
  lastUpdate     DateTime @default(now())
}

model CompletedProgressHistory {
  id             String   @id @default(uuid())
  raidName       String
  completedCount Int
  deltaCount     Int
  deltaDays      Int
  historyDate    DateTime @default(now())
}

model UserSetting {
  id            String  @id @default(uuid())
  discordUserId String  @unique
  isAdmin       Boolean @default(false)

  @@index([discordUserId])
}

model RaidEvent {
  id                          String   @id @default(uuid())
  eventName                   String
  eventTime                   DateTime
  eventLocation               String
  eventOrganizerDiscordUserId String

  eventDescription      String?
  raidEventParticipants RaidEventParticipant[]

  eventId      String?       @unique
  discordEvent DiscordEvent? @relation(fields: [eventId], references: [eventId])
}

model DiscordEvent {
  id        String     @id @default(uuid())
  guildId   String
  eventId   String     @unique
  raidEvent RaidEvent?
}

model RaidEventParticipant {
  id          String            @id @default(uuid())
  raidEventId String
  raidEvent   RaidEvent         @relation(fields: [raidEventId], references: [id])
  characterId String
  character   RegisterCharacter @relation(fields: [characterId], references: [id])
  specialist  Specialist
}

enum CharacterClass {
  Adventurer
  Archer
  Swordman
  Mage
  MaterialArtist
}

enum Specialist {
  None
  // General
  Jajamaru
  Pyjama
  Chicken
  Pirate
  Wedding

  // Troll
  Angler
  Chef
  PetTrainer

  // Archer
  Ranger
  Assassin
  Destroyer
  WildKeeper
  FierCannoneer
  Scout
  DemonHunter
  AvengingAngel
  Sunchaser
  Blaster
  FogHunter

  // Swordman
  Warrior
  Ninja
  Crusader
  Berserker
  Gladiator
  BattleMonk
  DeathReaper
  Renegade
  WaterfallBerserker
  DragonKnight
  StoneBreaker

  // Mage
  RedMagician
  HolyMage
  BlueMagician
  DarkGunner
  Volcano
  TideLord
  Seer
  Archmage
  VoodooPriest
  Gravity
  FireStorm

  // MA
  DraconicFist
  MysticArts
  MaterWolf
  DemonWarrior
  FlameDruid
  HydraulicFist
  Thunderer
}

model CharacterSetting {
  id                String            @id @default(uuid())
  characterId       String            @unique
  character         RegisterCharacter @relation(fields: [characterId], references: [id])
  characterClass    CharacterClass
  defaultSpecialist Specialist
}

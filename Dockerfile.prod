FROM node:24-alpine

WORKDIR /app

# Enable pnpm via Corepack
RUN corepack enable

# Copy package files
COPY package.json ./
COPY pnpm-lock.yaml* ./

# Install production dependencies
RUN pnpm install --prod

# Copy source code
COPY src ./src

# If you rely on root tsconfig paths/settings, keep it available
COPY tsconfig.json /app/tsconfig.json

# Expose port for debugging if needed
EXPOSE 3000

# Run directly (no PM2)
CMD ["node", "--import", "tsx", "src/index.ts"]
